(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"5I2P":function(e,t,n){"use strict";n.r(t),n.d(t,"CustomerModule",(function(){return _}));var o=n("tyNb"),a=n("ofXK"),i=n("3Pt+"),c=n("OsiS"),r=n("ZAI4"),s=n("Wcq6"),d=n("x4++"),l=(n("5x/H"),n("Zs65"),n("EVdn")),b=(n("FlOX"),n("e1J8"),n("4WDQ")),u=n("PSD3"),m=n.n(u),h=n("P9ut"),f=n("fXoL"),p=n("bTqV"),g=n("kmnG"),C=n("qFsG");function y(e,t){if(1&e){var n=f.Wb();f.Vb(0,"a",22),f.gc("click",(function(){f.Cc(n);var e=f.kc().$implicit;return f.kc(2).deleteCusClick(e[0],e[4])})),f.Vb(1,"i",8),f.Nc(2,"close"),f.Ub(),f.Ub()}}function v(e,t){if(1&e){var n=f.Wb();f.Vb(0,"tr"),f.Vb(1,"td"),f.Vb(2,"a",18),f.Nc(3),f.Ub(),f.Ub(),f.Vb(4,"td"),f.Nc(5),f.Ub(),f.Vb(6,"td"),f.Nc(7),f.Ub(),f.Vb(8,"td"),f.Nc(9),f.Ub(),f.Vb(10,"td"),f.Nc(11),f.Ub(),f.Vb(12,"td"),f.Nc(13),f.Ub(),f.Vb(14,"td",16),f.Vb(15,"a",19),f.gc("click",(function(){f.Cc(n);var e=t.$implicit;return f.kc(2).ticketCusClick(e[4])})),f.Vb(16,"i",8),f.Nc(17,"create_new_folder"),f.Ub(),f.Ub(),f.Vb(18,"a",20),f.gc("click",(function(){f.Cc(n);var e=t.$implicit;return f.kc(2).editCusClick(e[0])})),f.Vb(19,"i",8),f.Nc(20,"edit"),f.Ub(),f.Ub(),f.Lc(21,y,3,0,"a",21),f.Ub(),f.Ub()}if(2&e){var o=t.$implicit,a=f.kc(2);f.Cb(2),f.sc("href","/jobs/customer/",o[4],"",f.Ec),f.Cb(1),f.Oc(o[1]),f.Cb(2),f.Oc(o[2]),f.Cb(2),f.Oc(o[3]),f.Cb(2),f.Oc(o[4]),f.Cb(2),f.Oc(o[5]),f.Cb(2),f.Oc(o[6]),f.Cb(8),f.qc("ngIf","Administrator"===a.role||"SubAdmin"===a.role)}}function w(e,t){if(1&e){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",4),f.Vb(2,"div",5),f.Vb(3,"div",6),f.Vb(4,"div",7),f.Vb(5,"i",8),f.Nc(6,"assignment"),f.Ub(),f.Ub(),f.Vb(7,"h4",9),f.Nc(8,"My Customers"),f.Ub(),f.Vb(9,"button",10),f.gc("click",(function(){return f.Cc(n),f.kc().addCus()})),f.Nc(10," Add New Customer "),f.Ub(),f.Ub(),f.Vb(11,"div",11),f.Qb(12,"div",12),f.Vb(13,"div",13),f.Vb(14,"table",14),f.Vb(15,"thead"),f.Vb(16,"tr"),f.Vb(17,"th"),f.Nc(18),f.Ub(),f.Vb(19,"th"),f.Nc(20),f.Ub(),f.Vb(21,"th"),f.Nc(22),f.Ub(),f.Vb(23,"th"),f.Nc(24),f.Ub(),f.Vb(25,"th"),f.Nc(26),f.Ub(),f.Vb(27,"th"),f.Nc(28),f.Ub(),f.Vb(29,"th",15),f.Nc(30),f.Ub(),f.Ub(),f.Ub(),f.Vb(31,"tfoot"),f.Vb(32,"tr"),f.Vb(33,"th"),f.Nc(34),f.Ub(),f.Vb(35,"th"),f.Nc(36),f.Ub(),f.Vb(37,"th"),f.Nc(38),f.Ub(),f.Vb(39,"th"),f.Nc(40),f.Ub(),f.Vb(41,"th"),f.Nc(42),f.Ub(),f.Vb(43,"th"),f.Nc(44),f.Ub(),f.Vb(45,"th",16),f.Nc(46),f.Ub(),f.Ub(),f.Ub(),f.Vb(47,"tbody"),f.Lc(48,v,22,8,"tr",17),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub()}if(2&e){var o=f.kc();f.Cb(18),f.Oc(o.dataTable.headerRow[0]),f.Cb(2),f.Oc(o.dataTable.headerRow[1]),f.Cb(2),f.Oc(o.dataTable.headerRow[2]),f.Cb(2),f.Oc(o.dataTable.headerRow[3]),f.Cb(2),f.Oc(o.dataTable.headerRow[4]),f.Cb(2),f.Oc(o.dataTable.headerRow[5]),f.Cb(2),f.Pc(" ",o.dataTable.headerRow[6]," "),f.Cb(4),f.Oc(o.dataTable.footerRow[0]),f.Cb(2),f.Oc(o.dataTable.footerRow[1]),f.Cb(2),f.Oc(o.dataTable.footerRow[2]),f.Cb(2),f.Oc(o.dataTable.footerRow[3]),f.Cb(2),f.Oc(o.dataTable.footerRow[4]),f.Cb(2),f.Oc(o.dataTable.headerRow[5]),f.Cb(2),f.Oc(o.dataTable.footerRow[6]),f.Cb(2),f.qc("ngForOf",o.dataTable.dataRows)}}function V(e,t){if(1&e){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",23),f.Vb(2,"div",5),f.Vb(3,"div",24),f.Vb(4,"div",7),f.Vb(5,"i",8),f.Nc(6,"mail_outline"),f.Ub(),f.Ub(),f.Vb(7,"h4",9),f.Nc(8,"New Customers"),f.Ub(),f.Ub(),f.Vb(9,"div",11),f.Vb(10,"form",25),f.Vb(11,"mat-form-field",26),f.Vb(12,"input",27),f.gc("ngModelChange",(function(e){return f.Cc(n),f.kc()._name=e})),f.Ub(),f.Ub(),f.Vb(13,"mat-form-field",26),f.Vb(14,"input",28),f.gc("ngModelChange",(function(e){return f.Cc(n),f.kc()._addr=e})),f.Ub(),f.Ub(),f.Vb(15,"mat-form-field",26),f.Vb(16,"input",29),f.gc("ngModelChange",(function(e){return f.Cc(n),f.kc()._phone=e})),f.Ub(),f.Ub(),f.Vb(17,"mat-form-field",26),f.Vb(18,"input",30),f.gc("ngModelChange",(function(e){return f.Cc(n),f.kc()._email=e})),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(19,"div",31),f.Vb(20,"button",32),f.gc("click",(function(){return f.Cc(n),f.kc().customerSubmitClicked()})),f.Nc(21),f.Ub(),f.Vb(22,"button",33),f.gc("click",(function(){return f.Cc(n),f.kc().cancelAddCus()})),f.Nc(23," Cancel "),f.Ub(),f.Ub(),f.Qb(24,"br"),f.Vb(25,"div",34),f.Qb(26,"p",35),f.Qb(27,"p",36),f.Ub(),f.Ub(),f.Ub(),f.Ub()}if(2&e){var o=f.kc();f.Cb(12),f.qc("ngModel",o._name),f.Cb(2),f.qc("ngModel",o._addr),f.Cb(2),f.qc("ngModel",o._phone),f.Cb(2),f.qc("ngModel",o._email),f.Cb(2),f.qc("disabled",o.button_pressed),f.Cb(1),f.Pc(" ",o.button_pressed?"Please wait...":"Submit"," ")}}var U=[{path:"",children:[{path:"",component:function(){function e(){this.data=[],this.customers=[],this.addNewCus=!1,this.editCus=!1,this.config=new b.a,this.button_pressed=!1,this.service=new h.a,this.role="",this._name="",this._addr="",this._phone="+234",this._email=""}return e.prototype.initAutoComplete=function(){var e=document.getElementById("cus_addr"),t=new google.maps.places.Autocomplete(e);t.setFields(["address_components","geometry","icon","name"]),t.addListener("place_changed",(function(){var e=t.getPlace();e.geometry||window.alert("No details available for input: '"+e.name+"'"),document.getElementById("mgeo").innerHTML=JSON.stringify(e.geometry.location.toJSON());var n="";e.address_components&&(n=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "),document.getElementById("madd").innerHTML=n)}))},e.prototype.getCustomers=function(){var e=this;s.firestore().collection("customers").orderBy("timestamp","desc").onSnapshot((function(t){e.data=[],e.customers=[],t.forEach((function(t){var n=t.data();e.customers.push(n),e.data.push([n.id,n.name,n.address,n.phone,n.email,n.created_date,n.modified_date,n.created_by,"btn-link"])})),e.dataTable={headerRow:["Name","Address","Phone Number","Email","Created Date","Modified Date","Actions"],footerRow:["Name","Address","Phone Number","Email","Created Date","Modified Date","Actions"],dataRows:e.data}}))},e.prototype.ngOnInit=function(){var e=this,t=localStorage.getItem("email");this.service.getUserData(t).then((function(t){e.role=t.role,e.getCustomers()}))},e.prototype.addCus=function(){var e=this;this.addNewCus=!0,this.editCus=!1,setTimeout((function(){e.initAutoComplete()}),3e3)},e.prototype.cancelAddCus=function(){this.addNewCus=!1,this.editCus=!1,this.button_pressed=!1,this._name="",this._addr="",this._phone="+234",this._email=""},e.prototype.deleteCusClick=function(e,t){var n=this;m()({title:"Delete Alert",text:"Are you sure about deleting this customer?",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1}).then((function(o){o.value?s.firestore().collection("customers").doc(e).delete().then((function(e){var o=localStorage.getItem("email"),a=localStorage.getItem("name");n.config.logActivity(a+"|"+o+" deleted this customer: "+t),n.config.displayMessage("Successfully deleted",!0)})).catch((function(e){n.config.displayMessage(""+e,!1)})):m()({title:"Cancelled",text:"Deletion not successful",type:"error",confirmButtonClass:"btn btn-info",buttonsStyling:!1}).catch(m.a.noop)}))},e.prototype.editCusClick=function(e){var t=this;this.editCus=!0,this.addNewCus=!0,this.selectedCustomer=this.customers.find((function(t,n,o){return t.id===e})),this._name=this.selectedCustomer.name,this._addr=this.selectedCustomer.address,this._phone=this.selectedCustomer.phone,this._email=this.selectedCustomer.email,setTimeout((function(){document.getElementById("madd").innerHTML=t.selectedCustomer.address,document.getElementById("mgeo").innerHTML=JSON.stringify(t.selectedCustomer.position.geopoint),t.initAutoComplete()}),3e3)},e.prototype.ticketCusClick=function(e){location.href="/new-ticket?customer="+e},e.prototype.customerSubmitClicked=function(){return e=this,void 0,n=function(){var e,t,n,o,a,i,c,r,l,b,u,m=this;return function(e,t){var n,o,a,i,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(a=2&i[0]?o.return:i[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((a=(a=c.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){c.label=i[1];break}if(6===i[0]&&c.label<a[1]){c.label=a[1],a=i;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(i);break}a[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(r){i=[6,r],o=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}}(this,(function(h){switch(h.label){case 0:return e=document.getElementById("cus_name").value,t=document.getElementById("cus_phone").value,n=document.getElementById("cus_email").value,o=document.getElementById("madd").innerHTML,""===e||""===t||""===o||""===n?(this.config.displayMessage("Please fill all fields and use google autocomplete for address.",!1),[2]):t.startsWith("+234")?(a=JSON.parse(document.getElementById("mgeo").innerHTML),this.button_pressed=!0,i=s.database().ref().push().key,c=localStorage.getItem("email"),r=localStorage.getItem("name"),l=d.a(s),this.editCus?[3,2]:[4,s.firestore().collection("customers").where("email","==",n).get()]):(this.config.displayMessage("Please input correct address. Must start with +234",!1),[2]);case 1:return h.sent().size>0?(this.button_pressed=!1,this.config.displayMessage("customer already exists",!1),[2]):(b=l.point(a.lat,a.lng),u={id:i,name:e,address:o,position:{geohash:b.geohash,geopoint:b.geopoint},msgID:[],phone:t,email:n,created_by:r+"|"+c,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()},s.firestore().collection("customers").doc(n.toLowerCase()).set(u).then((function(e){m.config.logActivity(r+"|"+c+" created this customer: "+n),m.cancelAddCus(),m.config.displayMessage("Successfully created",!0)})).catch((function(e){m.button_pressed=!1,m.config.displayMessage(""+e,!1)})),[3,3]);case 2:b=void 0===a.lat?l.point(a.latitude,a.longitude):l.point(a.lat,a.lng),u={name:e,address:o,position:{geohash:b.geohash,geopoint:b.geopoint},phone:t,email:n,modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString()},s.firestore().collection("customers").doc(this.selectedCustomer.email).update(u).then((function(e){m.config.logActivity(r+"|"+c+" updated this customer: "+n),m.cancelAddCus(),m.config.displayMessage("Successfully updated",!0)})).catch((function(e){m.button_pressed=!1,m.config.displayMessage(""+e,!1)})),h.label=3;case 3:return[2]}}))},new((t=void 0)||(t=Promise))((function(o,a){function i(e){try{r(n.next(e))}catch(t){a(t)}}function c(e){try{r(n.throw(e))}catch(t){a(t)}}function r(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,c)}r((n=n.apply(e,[])).next())}));var e,t,n},e.prototype.ngAfterViewInit=function(){l("#datatables").DataTable({pagingType:"full_numbers",lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],responsive:!0,language:{search:"_INPUT_",searchPlaceholder:"Search records"}}),l("#datatables").DataTable(),l(".card .material-datatables label").addClass("form-group")},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=f.Jb({type:e,selectors:[["app-customer"]],decls:4,vars:2,consts:[[1,"main-content"],[1,"container-fluid"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-primary","card-header-icon"],[1,"card-icon"],[1,"material-icons"],[1,"card-title"],["mat-raised-button","",1,"btn","btn-primary",3,"click"],[1,"card-body"],[1,"toolbar"],[1,"material-datatables"],["id","datatables","cellspacing","0","width","100%",1,"table","table-striped","table-no-bordered","table-hover",2,"width","100%"],[1,"disabled-sorting","text-right"],[1,"text-right"],[4,"ngFor","ngForOf"],[3,"href"],["href","javascript:void(0)","data-toggle","tooltip","title","new ticket","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","create_new_folder",3,"click"],["href","javascript:void(0)","data-toggle","tooltip","title","edit","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","edit",3,"click"],["href","javascript:void(0)","data-toggle","tooltip","title","delete","data-placement","bottom","class","btn btn-link btn-danger btn-just-icon remove",3,"click",4,"ngIf"],["href","javascript:void(0)","data-toggle","tooltip","title","delete","data-placement","bottom",1,"btn","btn-link","btn-danger","btn-just-icon","remove",3,"click"],[1,"col-md-10","offset-md-1"],[1,"card-header","card-header-rose","card-header-icon"],["method","#","action","#"],[1,"example-full-width"],["matInput","","placeholder","Name","name","mMame","type","text","id","cus_name",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder"," Address","type","address","autocomplete","off","name","mAddr","id","cus_addr",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder","Phone Number","name","mPhone","type","tel","id","cus_phone",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","name","memail","placeholder","Email","type","email","id","cus_email",1,"form-control",3,"ngModel","ngModelChange"],[1,"card-footer"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-rose","btn-block",3,"disabled","click"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-block","btn-danger",3,"click"],[2,"display","none"],["id","madd"],["id","mgeo"]],template:function(e,t){1&e&&(f.Vb(0,"div",0),f.Vb(1,"div",1),f.Lc(2,w,49,15,"div",2),f.Lc(3,V,28,6,"div",2),f.Ub(),f.Ub()),2&e&&(f.Cb(2),f.qc("ngIf",!t.addNewCus),f.Cb(1),f.qc("ngIf",t.addNewCus))},directives:[a.m,p.b,a.l,i.A,i.r,i.s,g.c,C.b,i.e,i.q,i.t],styles:[""]}),e}()}]}],_=function(){function e(){}return e.\u0275mod=f.Nb({type:e}),e.\u0275inj=f.Mb({factory:function(t){return new(t||e)},imports:[[a.c,o.g.forChild(U),i.l,c.a,r.b]]}),e}()}}]);