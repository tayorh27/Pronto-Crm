(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"3wwd":function(t,e,n){"use strict";n.r(e),n.d(e,"NewTicketModule",(function(){return vt}));var o=n("tyNb"),i=n("ofXK"),a=n("3Pt+"),r=n("OsiS"),c=n("ZAI4"),s=n("Wcq6"),l=(n("5x/H"),n("Zs65"),n("x4++")),d=(n("FlOX"),n("e1J8"),n("4WDQ")),b=n("WONP"),u=n("QebF"),h=n("P9ut"),f=n("fXoL"),m=n("tk/3"),g=n("kmnG"),p=n("d3UM"),v=n("qFsG"),y=n("bTqV"),U=n("FKr1"),C=n("EVdn"),V=n("PSD3"),w=n.n(V),_=n("1kSV"),k=function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function r(t){try{s(o.next(t))}catch(e){a(e)}}function c(t){try{s(o.throw(t))}catch(e){a(e)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}s((o=o.apply(t,e||[])).next())}))},N=function(t,e){var n,o,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function S(t,e){if(1&t){var n=f.Wb();f.Vb(0,"li"),f.Vb(1,"a",14),f.gc("click",(function(){f.Cc(n);var t=e.$implicit;return f.kc(2).displayJobsByStatus(t.name)})),f.Nc(2),f.Ub(),f.Ub()}if(2&t){var o=e.$implicit;f.Cb(2),f.Oc(o.name)}}function T(t,e){if(1&t){var n=f.Wb();f.Vb(0,"a",27),f.gc("click",(function(){f.Cc(n);var t=f.kc().$implicit;return f.kc(2).deleteJob(t)})),f.Vb(1,"i",8),f.Nc(2,"close"),f.Ub(),f.Ub()}}function L(t,e){if(1&t){var n=f.Wb();f.Vb(0,"tr"),f.Vb(1,"td"),f.Nc(2),f.Ub(),f.Vb(3,"td"),f.Nc(4),f.Ub(),f.Vb(5,"td"),f.Nc(6),f.Ub(),f.Qb(7,"td",22),f.Vb(8,"td"),f.Qb(9,"div",23),f.Nc(10),f.Ub(),f.Vb(11,"td"),f.Nc(12),f.Ub(),f.Vb(13,"td"),f.Nc(14),f.Ub(),f.Vb(15,"td"),f.Nc(16),f.Ub(),f.Vb(17,"td",21),f.Vb(18,"a",24),f.gc("click",(function(){f.Cc(n);var t=e.$implicit;return f.kc(2).reassignJob(t)})),f.Vb(19,"i",8),f.Nc(20,"refresh"),f.Ub(),f.Ub(),f.Vb(21,"a",25),f.gc("click",(function(){f.Cc(n);var t=e.$implicit;return f.kc(2).editJob(t)})),f.Vb(22,"i",8),f.Nc(23,"edit"),f.Ub(),f.Ub(),f.Lc(24,T,3,0,"a",26),f.Ub(),f.Ub()}if(2&t){var o=e.$implicit,i=f.kc(2);f.Cb(2),f.Oc(o[10]),f.Cb(2),f.Oc(o[1]),f.Cb(2),f.Oc(o[2]),f.Cb(1),f.qc("innerHTML",o[8],f.Dc),f.Cb(2),f.qc("ngStyle",i.getStyle(o[4])),f.Cb(1),f.Pc(" ",o[4]," "),f.Cb(2),f.Oc(o[5]),f.Cb(2),f.Oc(o[6]),f.Cb(2),f.Oc(o[7]),f.Cb(8),f.qc("ngIf","Administrator"===i.role||"SubAdmin"===i.role)}}function I(t,e){if(1&t){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",4),f.Vb(2,"div",5),f.Vb(3,"div",6),f.Vb(4,"div",7),f.Vb(5,"i",8),f.Nc(6,"assignment"),f.Ub(),f.Ub(),f.Vb(7,"h4",9),f.Nc(8,"Tickets"),f.Ub(),f.Vb(9,"div",10),f.Vb(10,"button",11),f.Vb(11,"i",8),f.Nc(12,"build"),f.Ub(),f.Vb(13,"span",12),f.Nc(14,"Toggle Ticket Status"),f.Ub(),f.Ub(),f.Vb(15,"ul",13),f.Vb(16,"li"),f.Vb(17,"a",14),f.gc("click",(function(){return f.Cc(n),f.kc().displayJobsByStatus("All")})),f.Nc(18,"All"),f.Ub(),f.Ub(),f.Lc(19,S,3,1,"li",15),f.Ub(),f.Ub(),f.Ub(),f.Vb(20,"div",16),f.Qb(21,"div",17),f.Vb(22,"div",18),f.Vb(23,"table",19),f.Vb(24,"thead"),f.Vb(25,"tr"),f.Vb(26,"th"),f.Nc(27),f.Ub(),f.Vb(28,"th"),f.Nc(29),f.Ub(),f.Vb(30,"th"),f.Nc(31),f.Ub(),f.Vb(32,"th"),f.Nc(33),f.Ub(),f.Vb(34,"th"),f.Nc(35),f.Ub(),f.Vb(36,"th"),f.Nc(37),f.Ub(),f.Vb(38,"th"),f.Nc(39),f.Ub(),f.Vb(40,"th"),f.Nc(41),f.Ub(),f.Vb(42,"th",20),f.Nc(43),f.Ub(),f.Ub(),f.Ub(),f.Vb(44,"tfoot"),f.Vb(45,"tr"),f.Vb(46,"th"),f.Nc(47),f.Ub(),f.Vb(48,"th"),f.Nc(49),f.Ub(),f.Vb(50,"th"),f.Nc(51),f.Ub(),f.Vb(52,"th"),f.Nc(53),f.Ub(),f.Vb(54,"th"),f.Nc(55),f.Ub(),f.Vb(56,"th"),f.Nc(57),f.Ub(),f.Vb(58,"th"),f.Nc(59),f.Ub(),f.Vb(60,"th"),f.Nc(61),f.Ub(),f.Vb(62,"th",21),f.Nc(63),f.Ub(),f.Ub(),f.Ub(),f.Vb(64,"tbody"),f.Lc(65,L,25,10,"tr",15),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub()}if(2&t){var o=f.kc();f.Cb(19),f.qc("ngForOf",o.statuses),f.Cb(8),f.Oc(o.dataTable.headerRow[8]),f.Cb(2),f.Oc(o.dataTable.headerRow[0]),f.Cb(2),f.Oc(o.dataTable.headerRow[1]),f.Cb(2),f.Oc(o.dataTable.headerRow[2]),f.Cb(2),f.Oc(o.dataTable.headerRow[3]),f.Cb(2),f.Oc(o.dataTable.headerRow[4]),f.Cb(2),f.Oc(o.dataTable.headerRow[5]),f.Cb(2),f.Oc(o.dataTable.headerRow[6]),f.Cb(2),f.Pc(" ",o.dataTable.headerRow[7]," "),f.Cb(4),f.Oc(o.dataTable.footerRow[8]),f.Cb(2),f.Oc(o.dataTable.footerRow[0]),f.Cb(2),f.Oc(o.dataTable.footerRow[1]),f.Cb(2),f.Oc(o.dataTable.footerRow[2]),f.Cb(2),f.Oc(o.dataTable.footerRow[3]),f.Cb(2),f.Oc(o.dataTable.footerRow[4]),f.Cb(2),f.Oc(o.dataTable.footerRow[5]),f.Cb(2),f.Oc(o.dataTable.footerRow[6]),f.Cb(2),f.Oc(o.dataTable.footerRow[7]),f.Cb(2),f.qc("ngForOf",o.dataTable.dataRows)}}function M(t,e){if(1&t){var n=f.Wb();f.Vb(0,"li"),f.Vb(1,"a",14),f.gc("click",(function(){f.Cc(n);var t=e.$implicit;return f.kc(3).updateStatus(t.name)})),f.Nc(2),f.Ub(),f.Ub()}if(2&t){var o=e.$implicit;f.Cb(2),f.Oc(o.name)}}var O=function(t){return{color:t}};function E(t,e){if(1&t){var n=f.Wb();f.Vb(0,"div",4),f.Vb(1,"button",33),f.gc("click",(function(){return f.Cc(n),f.kc(2).cancelViewJob()})),f.Nc(2," Cancel "),f.Ub(),f.Vb(3,"ul",34),f.Vb(4,"li",35),f.Vb(5,"div",36),f.Vb(6,"i",8),f.Nc(7,"work"),f.Ub(),f.Ub(),f.Vb(8,"div",37),f.Vb(9,"div",38),f.Vb(10,"span",39),f.Nc(11,"JOB REQUEST"),f.Ub(),f.Ub(),f.Vb(12,"div",40),f.Vb(13,"p"),f.Nc(14," Comment: "),f.Qb(15,"br"),f.Vb(16,"strong"),f.Nc(17),f.Ub(),f.Ub(),f.Qb(18,"br"),f.Vb(19,"p",41),f.Nc(20," Status: "),f.Qb(21,"br"),f.Vb(22,"strong"),f.Nc(23),f.Ub(),f.Ub(),f.Qb(24,"br"),f.Vb(25,"p"),f.Nc(26,"Request:"),f.Ub(),f.Qb(27,"div",22),f.Qb(28,"hr"),f.Vb(29,"div",10),f.Vb(30,"button",11),f.Vb(31,"i",8),f.Nc(32,"build"),f.Ub(),f.Vb(33,"span",12),f.Nc(34,"Update Job Status"),f.Ub(),f.Ub(),f.Vb(35,"ul",13),f.Lc(36,M,3,1,"li",15),f.Ub(),f.Ub(),f.Vb(37,"div",42),f.Vb(38,"button",43),f.gc("click",(function(){f.Cc(n);var t=f.kc(2);return t.reassignJob([t.selectedJob.id,"","",t.selectedJob.customer.email])})),f.Nc(39," Re-Assign Job "),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(40,"li",35),f.Vb(41,"div",44),f.Vb(42,"i",8),f.Nc(43,"handyman"),f.Ub(),f.Ub(),f.Vb(44,"div",37),f.Vb(45,"div",38),f.Vb(46,"span",45),f.Nc(47,"TECHNICIAN INFO"),f.Ub(),f.Ub(),f.Vb(48,"div",40),f.Vb(49,"div",46),f.Vb(50,"div",47),f.Vb(51,"div",48),f.Vb(52,"a",49),f.Qb(53,"img",50),f.Ub(),f.Ub(),f.Vb(54,"div",16),f.Vb(55,"h6",51),f.Nc(56),f.Ub(),f.Vb(57,"h4",9),f.Nc(58),f.Ub(),f.Vb(59,"p",52),f.Nc(60),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(61,"h6"),f.Qb(62,"i",53),f.Nc(63),f.Ub(),f.Ub(),f.Ub(),f.Vb(64,"li",35),f.Vb(65,"div",54),f.Vb(66,"i",8),f.Nc(67,"people"),f.Ub(),f.Ub(),f.Vb(68,"div",37),f.Vb(69,"div",38),f.Vb(70,"span",55),f.Nc(71,"CUSTOMER INFO"),f.Ub(),f.Ub(),f.Vb(72,"div",40),f.Vb(73,"div",46),f.Vb(74,"div",47),f.Vb(75,"div",48),f.Vb(76,"a",49),f.Qb(77,"img",56),f.Ub(),f.Ub(),f.Vb(78,"div",16),f.Vb(79,"h6",51),f.Nc(80),f.Ub(),f.Vb(81,"h4",9),f.Nc(82),f.Ub(),f.Vb(83,"p",52),f.Nc(84),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(85,"h6"),f.Qb(86,"i",53),f.Nc(87),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Qb(88,"br"),f.Vb(89,"button",33),f.gc("click",(function(){return f.Cc(n),f.kc(2).cancelViewJob()})),f.Nc(90," Cancel "),f.Ub(),f.Ub()}if(2&t){var o=f.kc(2);f.Cb(17),f.Oc(o.selectedJob.note),f.Cb(2),f.qc("ngStyle",f.uc(15,O,o.getStatusColorByName(o.selectedJob.status))),f.Cb(4),f.Oc(o.selectedJob.status),f.Cb(4),f.qc("innerHTML",o.displayHTMLCategories(o.selectedJob.category),f.Dc),f.Cb(9),f.qc("ngForOf",o.statuses),f.Cb(17),f.rc("src",o.selectedJob.assigned_to.image,f.Ec),f.Cb(3),f.Pc(" ",o.selectedJob.assigned_to.email," "),f.Cb(2),f.Pc(" ",o.selectedJob.assigned_to.phone," "),f.Cb(2),f.Pc(" ",o.selectedJob.assigned_to.address," "),f.Cb(3),f.Qc(" ",o.selectedJob.assigned_to.name," - ",o.selectedJob.assigned_to.status," "),f.Cb(17),f.Pc(" ",o.selectedJob.customer.email," "),f.Cb(2),f.Pc(" ",o.selectedJob.customer.phone," "),f.Cb(2),f.Pc(" ",o.selectedJob.customer.address," "),f.Cb(3),f.Pc(" ",o.selectedJob.customer.name,"")}}function A(t,e){if(1&t&&(f.Vb(0,"tr"),f.Vb(1,"td"),f.Nc(2),f.Ub(),f.Vb(3,"td"),f.Nc(4),f.Ub(),f.Vb(5,"td"),f.Nc(6),f.Ub(),f.Vb(7,"td"),f.Nc(8),f.Ub(),f.Ub()),2&t){var n=e.$implicit,o=e.index;f.Cb(2),f.Oc(o+1),f.Cb(2),f.Oc(n.comment),f.Cb(2),f.Oc(n.action),f.Cb(2),f.Oc(n.created_date)}}function P(t,e){if(1&t&&(f.Vb(0,"div",4),f.Vb(1,"div",16),f.Qb(2,"div",17),f.Vb(3,"div",18),f.Vb(4,"table",57),f.Vb(5,"thead"),f.Vb(6,"tr"),f.Vb(7,"th"),f.Nc(8,"ID"),f.Ub(),f.Vb(9,"th"),f.Nc(10,"COMMENT"),f.Ub(),f.Vb(11,"th"),f.Nc(12,"REASONS"),f.Ub(),f.Vb(13,"th"),f.Nc(14,"CREATED DATE"),f.Ub(),f.Ub(),f.Ub(),f.Vb(15,"tfoot"),f.Vb(16,"tr"),f.Vb(17,"th"),f.Nc(18,"ID"),f.Ub(),f.Vb(19,"th"),f.Nc(20,"COMMENT"),f.Ub(),f.Vb(21,"th"),f.Nc(22,"REASONS"),f.Ub(),f.Vb(23,"th"),f.Nc(24,"CREATED DATE"),f.Ub(),f.Ub(),f.Ub(),f.Vb(25,"tbody"),f.Lc(26,A,9,4,"tr",15),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub()),2&t){var n=f.kc(2);f.Cb(26),f.qc("ngForOf",n.activities)}}function j(t,e){1&t&&(f.Vb(0,"div",3),f.Vb(1,"div",28),f.Vb(2,"ngb-tabset",29),f.Vb(3,"ngb-tab",30),f.Lc(4,E,91,17,"ng-template",31),f.Ub(),f.Vb(5,"ngb-tab",32),f.Lc(6,P,27,1,"ng-template",31),f.Ub(),f.Ub(),f.Ub(),f.Ub()),2&t&&(f.Cb(2),f.qc("justify","center"))}var J=function(){function t(){this.cusEmail="",this.data=[],this.jobs=[],this.statuses=[],this.categories=[],this.activities=[],this.viewJob=!1,this.config=new d.a,this.button_pressed=!1,this.service=new h.a,this.role=""}return t.prototype.getJobByStatus=function(t){var e=this;(""===this.cusEmail?s.firestore().collection("jobs").where("status","==",t).orderBy("timestamp","desc"):s.firestore().collection("jobs").where("status","==",t).where("customer.email","==",this.cusEmail).orderBy("timestamp","desc")).onSnapshot((function(t){e.data=[],e.jobs=[],t.forEach((function(t){var n=t.data();e.jobs.push(n),e.data.push([n.id,n.assigned_to.name,n.customer.name,n.customer.email,n.status,n.created_by,n.created_date,n.modified_date,e.displayHTMLCategories(n.category),"btn-link",""+n.job_id])})),e.dataTable={headerRow:["Assigned To","Customer","Job Request","Status","Created By","Created Date","Modified Date","Actions","ID"],footerRow:["Assigned To","Customer","Job Request","Status","Created By","Created Date","Modified Date","Actions","ID"],dataRows:e.data}}))},t.prototype.displayJobsByStatus=function(t){"All"!==t?this.getJobByStatus(t):this.getJob()},t.prototype.getJob=function(){var t=this;(""===this.cusEmail?s.firestore().collection("jobs").orderBy("timestamp","desc"):s.firestore().collection("jobs").where("customer.email","==",this.cusEmail).orderBy("timestamp","desc")).onSnapshot((function(e){t.data=[],t.jobs=[],e.forEach((function(e){var n=e.data();t.jobs.push(n),t.data.push([n.id,n.assigned_to.name,n.customer.name,n.customer.email,n.status,n.created_by,n.created_date,n.modified_date,t.displayHTMLCategories(n.category),"btn-link",""+n.job_id])})),t.dataTable={headerRow:["Assigned To","Customer","Skill-Set","Status","Created By","Created Date","Modified Date","Actions","ID"],footerRow:["Assigned To","Customer","Skill-Set","Status","Created By","Created Date","Modified Date","Actions","ID"],dataRows:t.data}}))},Object.defineProperty(t.prototype,"totalRows",{get:function(){return this.getJob.length},enumerable:!1,configurable:!0}),t.prototype.getStatus=function(){var t=this;s.firestore().collection("status").orderBy("name","asc").get().then((function(e){t.statuses=[],e.forEach((function(e){var n=e.data();t.statuses.push(n)})),t.getCategories()}))},t.prototype.getStatusColorByName=function(t){return this.statuses.find((function(e,n,o){return e.name===t})).color},t.prototype.getCategories=function(){var t=this;s.firestore().collection("categories").orderBy("name","desc").onSnapshot((function(e){if(t.categories=[],e.forEach((function(e){var n=e.data();t.categories.push(n)})),""===location.search)t.getJob();else{var n=location.search.substring(3).replace("%20"," ");t.getJobByStatus(n)}}))},t.prototype.getStyle=function(t){return{background:""+this.getStatusColorByName(t),width:"20px",height:"20px","border-radius":"10px"}},t.prototype.ngOnInit=function(){var t=this,e=localStorage.getItem("email");this.service.getUserData(e).then((function(e){t.role=e.role,t.getStatus()}))},t.prototype.getCategoryNameById=function(t){return this.categories.find((function(e,n,o){return e.id===t})).name},t.prototype.displayHTMLCategories=function(t){var e=this,n="<ul>";return t.forEach((function(t){var o=e.getCategoryNameById(t);n+=void 0===o?"":"<li><strong>"+o+"</strong></li>"})),n+="</ul>"},t.prototype.editJob=function(t){this.selectedJob=this.jobs.find((function(e,n,o){return e.id===t[0]})),this.viewJob=!0,this.getJobActivities()},t.prototype.getJobActivities=function(){var t=this;s.firestore().collection("jobs").doc(this.selectedJob.id).collection("activities").orderBy("timestamp","desc").onSnapshot((function(e){t.activities=[],e.forEach((function(e){var n=e.data();t.activities.push(n)}))}))},t.prototype.cancelViewJob=function(){this.viewJob=!1,this.selectedJob=null},t.prototype.deleteJob=function(t){var e=this,n=t[0];w()({title:"Delete Alert",text:"Are you sure about deleting this job?",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1}).then((function(t){t.value?s.firestore().collection("jobs").doc(n).delete().then((function(t){var n=localStorage.getItem("email"),o=localStorage.getItem("name");e.config.logActivity(o+"|"+n+" deleted a job"),e.config.displayMessage("Successfully deleted",!0)})).catch((function(t){e.config.displayMessage(""+t,!1)})):w()({title:"Cancelled",text:"Deletion not successful",type:"error",confirmButtonClass:"btn btn-info",buttonsStyling:!1}).catch(w.a.noop)}))},t.prototype.updateStatus=function(t){var e=this,n=localStorage.getItem("email"),o=localStorage.getItem("name");s.firestore().collection("jobs").doc(this.selectedJob.id).update({status:t}).then((function(i){return k(e,void 0,void 0,(function(){var e,i,a=this;return N(this,(function(r){switch(r.label){case 0:return document.getElementById("stat").innerHTML="Status: <br><strong>"+t+"</strong>",[4,this.backEndJobUpdate(t)];case 1:return r.sent(),e=s.database().ref().push().key,i={id:e,comment:"This job status was changed to : "+t,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()},s.firestore().collection("jobs").doc(this.selectedJob.id).collection("activities").doc(e).set(i).then((function(e){a.config.logActivity(o+"|"+n+" updated job status to : "+t),a.config.displayMessage("Status updated successfully",!0)})).catch((function(t){a.config.displayMessage(""+t,!1)})),[2]}}))}))})).catch((function(t){e.config.displayMessage(""+t,!1)}))},t.prototype.reassignJob=function(t){location.href="/new-ticket?customer="+t[3]+"&jobid="+t[0]},t.prototype.backEndJobUpdate=function(t){return k(this,void 0,void 0,(function(){var e;return N(this,(function(n){switch(n.label){case 0:return e=localStorage.getItem("email"),[4,s.firestore().collection("jobs").doc(this.selectedJob.id).update({back_end_status:"completed"===t.toLowerCase()||"canceled"===t.toLowerCase()||"cancelled"===t.toLowerCase()?"inactive":"active"})];case 1:return n.sent(),"completed"!==t.toLowerCase()&&"canceled"!==t.toLowerCase()&&"cancelled"!==t.toLowerCase()||this.config.updateTechnicianStatus(e,"online"),[2]}}))}))},t.prototype.ngAfterViewInit=function(){C("#datatables").DataTable({pagingType:"full_numbers",lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],responsive:!0,language:{search:"_INPUT_",searchPlaceholder:"Search records"}}),C("#datatables").DataTable(),C(".card .material-datatables label").addClass("form-group")},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=f.Jb({type:t,selectors:[["ticket-add-job"]],inputs:{cusEmail:"cusEmail"},decls:4,vars:2,consts:[[1,"main-content"],[1,"container-fluid"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-primary","card-header-icon"],[1,"card-icon"],[1,"material-icons"],[1,"card-title"],[1,"dropdown","pull-left"],["mat-raised-button","","type","button","data-toggle","dropdown",1,"btn","btn-round","btn-info","dropdown-toggle"],[1,"caret"],["role","menu",1,"dropdown-menu","dropdown-menu-right"],["href","javascript:void(0)",3,"click"],[4,"ngFor","ngForOf"],[1,"card-body"],[1,"toolbar"],[1,"material-datatables"],["id","datatables","cellspacing","0","width","100%",1,"table","table-striped","table-no-bordered","table-hover",2,"width","100%"],[1,"disabled-sorting","text-right"],[1,"text-right"],[3,"innerHTML"],[3,"ngStyle"],["href","javascript:void(0)","data-toggle","tooltip","title","re-assign job","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","refresh",3,"click"],["href","javascript:void(0)","data-toggle","tooltip","title","edit","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","edit",3,"click"],["data-toggle","tooltip","title","delete","data-placement","bottom","href","javascript:void(0)","class","btn btn-link btn-danger btn-just-icon remove",3,"click",4,"ngIf"],["data-toggle","tooltip","title","delete","data-placement","bottom","href","javascript:void(0)",1,"btn","btn-link","btn-danger","btn-just-icon","remove",3,"click"],[1,"col-lg-12"],["type","pills",1,"custom-tab-content","flex-column","flex-md-row",3,"justify"],["title","INFORMATION"],["ngbTabContent",""],["title","ACTIVITIES"],["mat-raised-button","","type","button",1,"btn","btn-round","btn-danger",3,"click"],[1,"timeline","timeline-simple"],[1,"timeline-inverted"],[1,"timeline-badge","info"],[1,"timeline-panel"],[1,"timeline-heading"],[1,"badge","badge-info"],[1,"timeline-body"],["id","stat",3,"ngStyle"],[1,"dropdown","pull-right"],["mat-raised-button","","type","button",1,"btn","btn-round","btn-primary",3,"click"],[1,"timeline-badge","success"],[1,"badge","badge-success"],[1,"col-md-4"],[1,"card","card-profile"],[1,"card-avatar"],["href","javascript:void(0)"],[1,"img",3,"src"],[1,"card-category","text-gray"],[1,"card-description"],[1,"ti-time"],[1,"timeline-badge","danger"],[1,"badge","badge-danger"],["src","assets/img/default-avatar.png",1,"img"],["id","datatables2","cellspacing","0","width","100%",1,"table","table-striped","table-no-bordered","table-hover",2,"width","100%"]],template:function(t,e){1&t&&(f.Vb(0,"div",0),f.Vb(1,"div",1),f.Lc(2,I,66,20,"div",2),f.Lc(3,j,7,1,"div",2),f.Ub(),f.Ub()),2&t&&(f.Cb(2),f.qc("ngIf",!e.viewJob),f.Cb(1),f.qc("ngIf",e.viewJob))},directives:[i.m,y.b,i.l,i.n,_.e,_.c,_.d],styles:[""]}),t}(),x=n("JX91"),R=n("lJxs"),D=n("/1cH");function B(t,e){if(1&t&&(f.Vb(0,"mat-option",14),f.Nc(1),f.Ub()),2&t){var n=e.$implicit;f.qc("value",n.email),f.Cb(1),f.Qc(" ",n.name," - ",n.phone," ")}}var q=function(){function t(){this.customers=[],this.myControl=new a.g,this._onCustomerSelect=new f.o,this._AddCus=new f.o}return t.prototype.ngOnInit=function(){this.getCustomers()},t.prototype.getCustomers=function(){var t=this;s.firestore().collection("customers").orderBy("name","asc").get().then((function(e){t.customers=[],e.forEach((function(e){var n=e.data();t.customers.push(n)})),t.filteredOptions=t.myControl.valueChanges.pipe(Object(x.a)(""),Object(R.a)((function(e){return t._filter(e)})))}))},t.prototype._filter=function(t){var e=t.toLowerCase();return this.customers.filter((function(t){return t.name.toLowerCase().includes(e)||t.phone.toLowerCase().includes(e)}))},t.prototype.onCustomerSelect=function(t){this.myControl.setValue(""),this._onCustomerSelect.emit(t)},t.prototype.AddCus=function(){this._AddCus.emit(!0)},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=f.Jb({type:t,selectors:[["app-search-customer"]],outputs:{_onCustomerSelect:"_onCustomerSelect",_AddCus:"_AddCus"},decls:18,vars:5,consts:[[1,"card"],[1,"card-header","card-header-rose","card-header-icon"],[1,"card-icon"],[1,"material-icons"],[1,"card-title"],[1,"card-body"],["method","#","action","#"],[1,"example-full-width"],["type","text","placeholder","Enter Name","aria-label","Name","matInput","",3,"formControl","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"card-footer"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-rose",3,"click"],[3,"value"]],template:function(t,e){if(1&t&&(f.Vb(0,"div",0),f.Vb(1,"div",1),f.Vb(2,"div",2),f.Vb(3,"i",3),f.Nc(4,"search"),f.Ub(),f.Ub(),f.Vb(5,"h4",4),f.Nc(6,"Search For Customer"),f.Ub(),f.Ub(),f.Vb(7,"div",5),f.Vb(8,"form",6),f.Vb(9,"mat-form-field",7),f.Qb(10,"input",8),f.Vb(11,"mat-autocomplete",9,10),f.gc("optionSelected",(function(t){return e.onCustomerSelect(t)})),f.Lc(13,B,2,3,"mat-option",11),f.lc(14,"async"),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(15,"div",12),f.Vb(16,"button",13),f.gc("click",(function(){return e.AddCus()})),f.Nc(17,"Add"),f.Ub(),f.Ub(),f.Ub()),2&t){var n=f.yc(12);f.Cb(10),f.qc("formControl",e.myControl)("matAutocomplete",n),f.Cb(3),f.qc("ngForOf",f.mc(14,3,e.filteredOptions))}},directives:[a.A,a.r,a.s,g.c,v.b,a.e,D.c,a.q,a.h,D.a,i.l,y.b,U.n],pipes:[i.b],encapsulation:2}),t}(),Q=function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function r(t){try{s(o.next(t))}catch(e){a(e)}}function c(t){try{s(o.throw(t))}catch(e){a(e)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}s((o=o.apply(t,e||[])).next())}))},F=function(t,e){var n,o,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},H=["map"];function W(t,e){if(1&t&&(f.Vb(0,"mat-option",39),f.Nc(1),f.Ub()),2&t){var n=e.$implicit;f.qc("value",n.id),f.Cb(1),f.Pc(" ",n.name," ")}}function G(t,e){if(1&t&&(f.Vb(0,"li",40),f.Vb(1,"div",41),f.Vb(2,"i",9),f.Nc(3,"people"),f.Ub(),f.Ub(),f.Vb(4,"div",42),f.Vb(5,"div",43),f.Vb(6,"span",44),f.Nc(7,"CUSTOMER INFO"),f.Ub(),f.Ub(),f.Vb(8,"div",45),f.Vb(9,"div",46),f.Vb(10,"div",47),f.Vb(11,"div",48),f.Vb(12,"a",49),f.Qb(13,"img",50),f.Ub(),f.Ub(),f.Vb(14,"div",51),f.Vb(15,"h6",52),f.Nc(16),f.Ub(),f.Vb(17,"h4",19),f.Nc(18),f.Ub(),f.Vb(19,"p",53),f.Nc(20),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(21,"h6"),f.Qb(22,"i",54),f.Nc(23),f.Ub(),f.Ub(),f.Ub()),2&t){var n=f.kc(2);f.Cb(16),f.Pc(" ",n.selectedCustomer.email," "),f.Cb(2),f.Pc(" ",n.selectedCustomer.phone," "),f.Cb(2),f.Pc(" ",n.selectedCustomer.address," "),f.Cb(3),f.Pc(" ",n.selectedCustomer.name,"")}}function $(t,e){if(1&t&&f.Qb(0,"ticket-add-job",55),2&t){var n=f.kc(2);f.qc("cusEmail",n.selectedCustomer.email)}}var K,z=function(){return{standalone:!0}};function Y(t,e){if(1&t){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",4),f.Vb(2,"div",5),f.Vb(3,"ul",6),f.Vb(4,"li",7),f.Vb(5,"a",8),f.Vb(6,"i",9),f.Nc(7,"create_new_folder"),f.Ub(),f.Nc(8," New Ticket "),f.Ub(),f.Ub(),f.Vb(9,"li",7),f.Vb(10,"a",10),f.Vb(11,"i",9),f.Nc(12,"people"),f.Ub(),f.Nc(13," Customer Information "),f.Ub(),f.Ub(),f.Vb(14,"li",7),f.Vb(15,"a",11),f.Vb(16,"i",9),f.Nc(17,"work"),f.Ub(),f.Nc(18," Past Tickets "),f.Ub(),f.Ub(),f.Vb(19,"li",7),f.Vb(20,"a",12),f.gc("click",(function(){return f.Cc(n),f.kc().gotoSearch()})),f.Vb(21,"i",9),f.Nc(22,"search"),f.Ub(),f.Nc(23," Go to Search "),f.Ub(),f.Ub(),f.Ub(),f.Vb(24,"div",13),f.Vb(25,"div",14),f.Vb(26,"div",3),f.Vb(27,"div",15),f.Vb(28,"div",16),f.Vb(29,"div",17),f.Vb(30,"div",18),f.Vb(31,"h4",19),f.Nc(32,"New Ticket"),f.Ub(),f.Ub(),f.Ub(),f.Vb(33,"form"),f.Vb(34,"div",20),f.Vb(35,"mat-form-field"),f.Vb(36,"mat-select",21),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc()._cat=t})),f.Lc(37,W,2,2,"mat-option",22),f.Ub(),f.Ub(),f.Ub(),f.Vb(38,"div",20),f.Vb(39,"mat-form-field",23),f.Vb(40,"input",24),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc()._addr=t})),f.Ub(),f.Ub(),f.Ub(),f.Vb(41,"div",20),f.Vb(42,"mat-form-field",23),f.Vb(43,"input",25),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc().radius=t})),f.Ub(),f.Ub(),f.Ub(),f.Vb(44,"div",20),f.Vb(45,"mat-form-field",23),f.Vb(46,"textarea",26),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc()._note=t})),f.Ub(),f.Ub(),f.Ub(),f.Vb(47,"div",27),f.Vb(48,"button",28),f.gc("click",(function(){return f.Cc(n),f.kc().searchButtonClick()})),f.Nc(49),f.Ub(),f.Vb(50,"div",29),f.Qb(51,"p",30),f.Qb(52,"p",31),f.Vb(53,"button",32),f.gc("click",(function(){return f.Cc(n),f.kc().assignClicked()})),f.Nc(54," Assign "),f.Ub(),f.Qb(55,"p",33),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(56,"div",34),f.Vb(57,"ul",35),f.Lc(58,G,24,4,"li",36),f.Ub(),f.Ub(),f.Vb(59,"div",37),f.Lc(60,$,1,1,"ticket-add-job",38),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub()}if(2&t){var o=f.kc();f.Cb(36),f.qc("ngModel",o._cat),f.Cb(1),f.qc("ngForOf",o.categories),f.Cb(3),f.qc("ngModel",o._addr)("ngModelOptions",f.tc(10,z)),f.Cb(3),f.qc("ngModel",o.radius),f.Cb(3),f.qc("ngModel",o._note),f.Cb(2),f.qc("disabled",o.button_pressed),f.Cb(1),f.Pc(" ",o.button_pressed?"Please wait...":"Search"," "),f.Cb(9),f.qc("ngIf",o.selectedCustomer),f.Cb(2),f.qc("ngIf",o.selectedCustomer)}}function X(t,e){if(1&t){var n=f.Wb();f.Vb(0,"div",58),f.Vb(1,"div",16),f.Vb(2,"div",59),f.Vb(3,"div",60),f.Vb(4,"i",9),f.Nc(5,"mail_outline"),f.Ub(),f.Ub(),f.Vb(6,"h4",19),f.Nc(7,"New Customer"),f.Ub(),f.Ub(),f.Vb(8,"div",51),f.Vb(9,"form",61),f.Vb(10,"mat-form-field",23),f.Vb(11,"input",62),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc(2)._name=t})),f.Ub(),f.Ub(),f.Vb(12,"mat-form-field",23),f.Vb(13,"input",63),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc(2)._cus_addr=t})),f.Ub(),f.Ub(),f.Vb(14,"mat-form-field",23),f.Vb(15,"input",64),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc(2)._phone=t})),f.Ub(),f.Ub(),f.Vb(16,"mat-form-field",23),f.Vb(17,"input",65),f.gc("ngModelChange",(function(t){return f.Cc(n),f.kc(2)._email=t})),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(18,"div",27),f.Vb(19,"button",28),f.gc("click",(function(){return f.Cc(n),f.kc(2).customerSubmitClicked()})),f.Nc(20),f.Ub(),f.Ub(),f.Qb(21,"br"),f.Vb(22,"div",29),f.Qb(23,"p",30),f.Qb(24,"p",31),f.Ub(),f.Ub(),f.Ub()}if(2&t){var o=f.kc(2);f.Cb(11),f.qc("ngModel",o._name),f.Cb(2),f.qc("ngModel",o._cus_addr),f.Cb(2),f.qc("ngModel",o._phone),f.Cb(2),f.qc("ngModel",o._email),f.Cb(2),f.qc("disabled",o.button_pressed),f.Cb(1),f.Pc(" ",o.button_pressed?"Please wait...":"Submit"," ")}}function Z(t,e){if(1&t){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",46),f.Vb(2,"app-search-customer",56),f.gc("_onCustomerSelect",(function(t){return f.Cc(n),f.kc().onCustomerSelect(t)}))("_AddCus",(function(t){return f.Cc(n),f.kc().AddCus(t)})),f.Ub(),f.Ub(),f.Lc(3,X,25,6,"div",57),f.Ub()}if(2&t){var o=f.kc();f.Cb(3),f.qc("ngIf",o.isAddNewCus)}}var tt,et,nt={},ot={enableHighAccuracy:!0,timeout:6e4,maximumAge:0},it="https://maps.google.com/mapfiles/ms/icons/",at=[{path:"",children:[{path:"",component:function(){function t(t,e){this.http=t,this.previewProgressSpinner=e,this.config=new d.a,this.service=new h.a,this.categories=[],this.technicians=[],this._cat=[],this._addr="",this.radius=10,this._note="",this.button_pressed=!1,this.isReassign=!1,this.hasURLQuery=!1,this.isAddNewCus=!1,this.technicianSelected=!1,this.technicianSelectedName="",this._name="",this._cus_addr="",this._phone="+234",this._email="";var n=sessionStorage.getItem("current_state");if(null!==n&&""!==n){var o=JSON.parse(n);this._cat=o._cat,this.radius=o.radius,this._note=o._note,this.isAddNewCus=o.isAddNewCus,this._name=o._name,this._cus_addr=o._cus_addr,this._phone=o._phone,this._email=o._email}}return t.prototype.initMap=function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){K=new google.maps.Map(t.mapElement.nativeElement,{center:{lat:e.coords.latitude,lng:e.coords.longitude},zoom:10}),tt=new google.maps.InfoWindow,nt.current=new google.maps.Marker({position:{lat:e.coords.latitude,lng:e.coords.longitude},map:K,title:"Click to zoom",icon:it+"blue-dot.png"}),t.markerPan=nt.current,K.addListener("center_changed",(function(){window.setTimeout((function(){K.panTo(t.markerPan.getPosition())}),3e3)})),nt.current.addListener("click",(function(t){tt.setPosition(t.latLng),tt.setContent("Current location"),tt.open(K,nt.current)}))}),(function(e){t.config.displayMessage(e.message+". Refresh this page.",!1)}),ot)},t.prototype.createMarker=function(t,e,n,o){var i=this.isReassign,a=""+o.status,r="online"===a?"block":"none";nt[n]=new google.maps.Marker({map:K,position:{lat:t,lng:e},icon:"online"===a?it+"green-dot.png":it+"red-dot.png"}),this.markerPan=nt[n],google.maps.event.addListener(nt[n],"click",(function(){tt.setContent('<div class="card">\n      <div class="card-header card-header-text card-header-rose">\n        <div class="card-text">\n          <h4 class="card-title">'+o.name+'</h4>\n        </div>\n        <div class="card-body">\n        <label>Email Address: <a href="mailto:'+o.email+'">'+o.email+'</a></label><br>\n        <label>Phone Number: <a href="tel:'+o.phone+'">'+o.phone+'</a></label><br>\n        <label>Address: <a href="https://google.com/maps/'+o.address+'">'+o.address+"</a></label><br>\n        <label>Status: "+o.status+'</label><br>\n        </div>\n        <div class="card-footer">\n        <button style="display: '+r+';" mat-raised-button type="button" id="'+n+'" class="btn btn-fill btn-rose btn-block">\n              '+(i?"Re-Assign":"Assign")+"\n        </button>\n        </div>\n      </div>\n      </div>"),tt.open(K,nt[n]),setTimeout((function(){document.getElementById(n).addEventListener("click",(function(){document.getElementById("assign-id").innerText=n,document.getElementById("assignBtnClick").click()}))}),500)}))},t.prototype.ngOnDestroy=function(){sessionStorage.setItem("current_state",JSON.stringify({_cat:this._cat,radius:this.radius,_note:this._note,isAddNewCus:this.isAddNewCus,_name:this._name,_cus_addr:this._cus_addr,_phone:this._phone,_email:this._email}))},t.prototype.onCustomerSelect=function(t){var e=this;this.previewProgressSpinner.open({hasBackdrop:!0},b.a);var n=t.option.value;this.isAddNewCus=!1,this.hasURLQuery=!0,this.getCustomerByEmail(n).then((function(t){e.previewProgressSpinner.close()}))},t.prototype.AddCus=function(t){var e=this;this.isAddNewCus=t,setTimeout((function(){e.initAutoComplete()}),2e3)},t.prototype.customerSubmitClicked=function(){return Q(this,void 0,void 0,(function(){var t,e,n,o,i,a,r,c,d,b,u,h=this;return F(this,(function(f){switch(f.label){case 0:return t=document.getElementById("cus_name").value,e=document.getElementById("cus_phone").value,n=document.getElementById("cus_email").value,o=document.getElementById("madd").innerHTML,""===t||""===e||""===o||""===n?(this.config.displayMessage("Please fill all fields and use google autocomplete for address.",!1),[2]):e.startsWith("+234")?(i=JSON.parse(document.getElementById("mgeo").innerHTML),this.button_pressed=!0,a=s.database().ref().push().key,r=localStorage.getItem("email"),c=localStorage.getItem("name"),d=l.a(s),[4,s.firestore().collection("customers").where("email","==",n).get()]):(this.config.displayMessage("Please input correct address. Must start with +234",!1),[2]);case 1:return f.sent().size>0?(this.button_pressed=!1,this.config.displayMessage("customer already exists",!1),[2]):(b=d.point(i.lat,i.lng),u={id:a,name:t,address:o,position:{geohash:b.geohash,geopoint:b.geopoint},phone:e,email:n,created_by:c+"|"+r,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()},s.firestore().collection("customers").doc(n.toLowerCase()).set(u).then((function(t){h.button_pressed=!1,h.config.logActivity(c+"|"+r+" created this customer: "+n),h.onCustomerSelect({option:{value:n}})})).catch((function(t){h.button_pressed=!1,h.config.displayMessage(""+t,!1)})),[2])}}))}))},t.prototype.gotoSearch=function(){this.hasURLQuery=!1},t.prototype.ngOnInit=function(){var t=this;if(""!==location.search){var e=location.search;if(e.substring(1).startsWith("technician")&&(this.technicianSelected=!0,this.getTechnicianData()),e.substring(1).startsWith("customer")||e.startsWith("?customer")){this.hasURLQuery=!0;var n=this.config.getUrlParameter("customer"),o=this.config.getUrlParameter("jobid");this.getCustomerByEmail(n),void 0!==o&&(this.isReassign=!0,this.getJobDataById(o))}e.substring(1).startsWith("create")&&(this.AddCus(!0),this._phone="+"+this.config.getUrlParameter("number"))}this.getCategories();var i=localStorage.getItem("email");this.service.getUserData(i).then((function(e){t.currentUser=e}))},t.prototype.getTechnicianData=function(){return Q(this,void 0,void 0,(function(){var t,e,n,o;return F(this,(function(i){switch(i.label){case 0:return t=this.config.getUrlParameter("technician"),console.log(t),[4,s.firestore().collection("users").where("email","==",t).get()];case 1:return(e=i.sent()).empty?(this.config.displayMessage("Invalid technician.",!1),setTimeout((function(){location.href="/technician"}),2e3),[2]):(n=e.docs[0].data(),this.technicianSelectedName="Assign to "+n.name,o=n.position.geopoint,console.log(o),this.createMarker(o.latitude,o.longitude,n.id,n),[2])}}))}))},t.prototype.getCustomerByEmail=function(t){return Q(this,void 0,void 0,(function(){var e,n=this;return F(this,(function(o){switch(o.label){case 0:return[4,s.firestore().collection("customers").doc(t.toLowerCase()).get()];case 1:return(e=o.sent()).exists?(this.selectedCustomer=e.data(),this._addr=this.selectedCustomer.address,setTimeout((function(){document.getElementById("madd").innerHTML=n.selectedCustomer.address,document.getElementById("mgeo").innerHTML=JSON.stringify(n.selectedCustomer.position.geopoint)}),3e3),[2]):(this.config.displayMessage("Invalid customer.",!1),setTimeout((function(){location.href="/customer"}),2e3),[2])}}))}))},t.prototype.getJobDataById=function(t){return Q(this,void 0,void 0,(function(){var e;return F(this,(function(n){switch(n.label){case 0:return[4,s.firestore().collection("jobs").doc(t).get()];case 1:return(e=n.sent()).exists?(this.selectedJob=e.data(),this._cat=this.selectedJob.category,this._note=this.selectedJob.note,[2]):(this.config.displayMessage("Invalid job ID.",!1),setTimeout((function(){location.href="/customer"}),2e3),[2])}}))}))},t.prototype.getCategories=function(){var t=this;s.firestore().collection("categories").orderBy("name","asc").get().then((function(e){t.categories=[],e.forEach((function(e){var n=e.data();t.categories.push(n)}))}))},t.prototype.initAutoComplete=function(){var t=this.isAddNewCus?document.getElementById("cus_addr"):document.getElementById("formGroupExampleInput2"),e=new google.maps.places.Autocomplete(t);e.setFields(["address_components","geometry","icon","name"]),e.addListener("place_changed",(function(){var t=e.getPlace();t.geometry||window.alert("No details available for input: '"+t.name+"'"),document.getElementById("mgeo").innerHTML=JSON.stringify(t.geometry.location.toJSON());var n="";t.address_components&&(n=[t.address_components[0]&&t.address_components[0].short_name||"",t.address_components[1]&&t.address_components[1].short_name||"",t.address_components[2]&&t.address_components[2].short_name||""].join(" "),document.getElementById("madd").innerHTML=n)}))},t.prototype.searchButtonClick=function(){var t=document.getElementById("madd").innerHTML;0!==this._cat.length&&""!==t&&0!==this.radius&&null!==this.radius?this.searchForTechnicians():this.config.displayMessage("please fill all fields with *",!1)},t.prototype.searchForTechnicians=function(){return Q(this,void 0,void 0,(function(){var t,e,n,o,i=this;return F(this,(function(a){return this.button_pressed=!0,t=l.a(s),e=s.firestore().collection("users").where("user_type","==","technician").where("category","array-contains-any",this._cat).where("blocked","==",!1),n=JSON.parse(document.getElementById("mgeo").innerHTML),o=void 0===n.lat?t.point(n.latitude,n.longitude):t.point(n.lat,n.lng),t.query(e).within(o,this.radius,"position").subscribe((function(t){i.button_pressed=!1,0!==t.length?(i.technicians=[],nt={},t.forEach((function(t){i.technicians.push(t);var e=t.position.geopoint;i.createMarker(e.latitude,e.longitude,t.id,t)}))):i.config.displayMessage("No technicians found. Try again!",!1)})),[2]}))}))},t.prototype.assignClicked=function(){var t=this;this.previewProgressSpinner.open({hasBackdrop:!0},b.a);var e=document.getElementById("assign-id").innerText,n=this.technicians.find((function(t,n,o){return t.id===e})),o={name:n.name,blocked:n.blocked,address:n.address,position:n.position,phone:n.phone,email:(""+n.email).toLowerCase(),category:n.category,status:n.status},i=localStorage.getItem("email"),a=localStorage.getItem("name"),r=s.database().ref().push().key;if(this.isReassign)c={customer:this.selectedCustomer,assigned_to:o,agent:this.currentUser,status:"Pending",back_end_status:"active",category:this._cat,note:this._note,modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString()},s.firestore().collection("jobs").doc(this.selectedJob.id).update(c).then((function(e){var r=s.database().ref().push().key,c={id:r,comment:"This job was updated for : "+t.selectedCustomer.name+" and reassigned to "+o.name,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()};s.firestore().collection("jobs").doc(t.selectedJob.id).collection("activities").doc(r).set(c).then((function(e){t.previewProgressSpinner.close(),t.config.logActivity(a+"|"+i+" updated this job for : "+t.selectedCustomer.name+" and reassigned to "+o.name),t.sendSMS(n.name,n.phone,n.msgID,n.email),t.config.displayMessage("Successfully created",!0)})).catch((function(e){t.previewProgressSpinner.close(),t.config.displayMessage(""+e,!1)}))})).catch((function(e){t.previewProgressSpinner.close(),t.config.displayMessage(""+e,!1)}));else{var c={id:r,job_id:this.config.randomInt(0,9999999999),customer:this.selectedCustomer,assigned_to:o,agent:this.currentUser,status:"Pending",back_end_status:"active",category:this._cat,note:this._note,created_by:a+"|"+i,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()};s.firestore().collection("jobs").doc(r).set(c).then((function(e){var c=s.database().ref().push().key,l={id:c,comment:"This job was created for : "+t.selectedCustomer.name+" and assigned to "+o.name,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()};s.firestore().collection("jobs").doc(r).collection("activities").doc(c).set(l).then((function(e){t.previewProgressSpinner.close(),t.config.logActivity(a+"|"+i+" created this job for : "+t.selectedCustomer.name+" and assigned to "+o.name),t.sendSMS(n.name,n.phone,n.msgID,n.email),t.config.displayMessage("Successfully created",!0),setTimeout((function(){location.href="/jobs"}),2e3)})).catch((function(e){t.previewProgressSpinner.close(),t.config.displayMessage(""+e,!1)}))})).catch((function(e){t.previewProgressSpinner.close(),t.config.displayMessage(""+e,!1)}))}},t.prototype.sendSMS=function(t,e,n,o){var i="A technician will be with you shortly. \nName: "+t+"\nPhone: "+e;this.config.sendSMS(this.http,e,"You have been assigned a job. Please login to Pronto to accept the job and to view customer details.",n.join(","),"notification",o),this.config.sendSMS(this.http,this.selectedCustomer.phone,i,"","sms",o)},t.\u0275fac=function(e){return new(e||t)(f.Pb(m.a),f.Pb(u.b))},t.\u0275cmp=f.Jb({type:t,selectors:[["app-new-ticket"]],viewQuery:function(t,e){var n;1&t&&f.Rc(H,!0),2&t&&f.xc(n=f.hc())&&(e.mapElement=n.first)},decls:4,vars:2,consts:[[1,"main-content"],[1,"container-fluid"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-12","ml-auto","mr-auto"],[1,"page-categories"],["role","tablist",1,"nav","nav-pills","nav-pills-warning","nav-pills-icons","justify-content-center"],[1,"nav-item"],["data-toggle","tab","href","#link7","role","tablist",1,"nav-link","active"],[1,"material-icons"],["data-toggle","tab","href","#link8","role","tablist",1,"nav-link"],["data-toggle","tab","href","#link9","role","tablist",1,"nav-link"],["data-toggle","tab","href","javascript:void(0)","role","tablist",1,"nav-link",3,"click"],[1,"tab-content","tab-space","tab-subcategories"],["id","link7",1,"tab-pane","active"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-text","card-header-rose"],[1,"card-text"],[1,"card-title"],[1,"form-group","mx-sm-3","mb-2"],["multiple","","placeholder","Required skill-set *","name","plumber","ariaLabel","Techies[0]","id","tech_cat",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"example-full-width"],["matInput","","type","address","id","formGroupExampleInput2","placeholder","Address of customer*",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","placeholder","Radius in Km*","name","mRadius","type","number","id","tech_rad",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder","Additional comments for this job","name","nt","id","idnt",1,"form-control",3,"ngModel","ngModelChange"],[1,"card-footer"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-rose","btn-block",3,"disabled","click"],[2,"display","none"],["id","madd"],["id","mgeo"],["mat-raised-button","","type","submit","id","assignBtnClick",1,"btn","btn-fill","btn-rose","btn-block",3,"click"],["id","assign-id"],["id","link8",1,"tab-pane"],[1,"timeline","timeline-simple"],["class","timeline-inverted",4,"ngIf"],["id","link9",1,"tab-pane"],[3,"cusEmail",4,"ngIf"],[3,"value"],[1,"timeline-inverted"],[1,"timeline-badge","danger"],[1,"timeline-panel"],[1,"timeline-heading"],[1,"badge","badge-danger"],[1,"timeline-body"],[1,"col-md-4"],[1,"card","card-profile"],[1,"card-avatar"],["href","javascript:void(0)"],["src","assets/img/default-avatar.png",1,"img"],[1,"card-body"],[1,"card-category","text-gray"],[1,"card-description"],[1,"ti-time"],[3,"cusEmail"],[3,"_onCustomerSelect","_AddCus"],["class","col-md-8",4,"ngIf"],[1,"col-md-8"],[1,"card-header","card-header-rose","card-header-icon"],[1,"card-icon"],["method","#","action","#"],["matInput","","placeholder","Name","name","mMame","type","text","id","cus_name",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder"," Address","type","address","autocomplete","off","name","mAddr","id","cus_addr",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder","Phone Number","name","mPhone","type","tel","id","cus_phone",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","name","memail","placeholder","Email","type","email","id","cus_email",1,"form-control",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(f.Vb(0,"div",0),f.Vb(1,"div",1),f.Lc(2,Y,61,11,"div",2),f.Lc(3,Z,4,1,"div",2),f.Ub(),f.Ub()),2&t&&(f.Cb(2),f.qc("ngIf",e.hasURLQuery),f.Cb(1),f.qc("ngIf",!e.hasURLQuery))},directives:[i.m,a.A,a.r,a.s,g.c,p.a,a.q,a.t,i.l,v.b,a.e,a.v,y.b,U.n,J,q],styles:[".mapSize[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}"]}),t}()}]}],rt=n("Ji7U"),ct=n("LK+K"),st=(n("ODXe"),n("KQm4"),n("o0o1"),n("vuIU")),lt=n("1OyB"),dt=(n("mrSG"),n("HDdC"),n("2Vo4"),n("Cfvw"),n("PqYM"),n("XNiG"),n("04ZW"),n("VRyK"),n("jtHE"),n("QqCr"),n("LRne"),n("z6cu"),n("5+tZ"),n("c6ID"),n("eIep"),n("UXun"),n("/uUt"),n("1G5W"),n("zP0r"),n("oB13"),function(){var t=function t(){Object(lt.a)(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=f.Lb({token:t,factory:function(e){return t.\u0275fac(e)}}),t}()),bt=function(){function t(){Object(lt.a)(this,t)}return Object(st.a)(t,[{key:"getNativeWindow",value:function(){return window}}]),t}(),ut=function(){function t(){Object(lt.a)(this,t)}return Object(st.a)(t,[{key:"getNativeDocument",value:function(){return document}}]),t}(),ht=[bt,ut],ft=function(t){return t[t.HTTP=1]="HTTP",t[t.HTTPS=2]="HTTPS",t[t.AUTO=3]="AUTO",t}({}),mt=new f.s("angular-google-maps LAZY_MAPS_API_CONFIG"),gt=function(){var t=function(t){Object(rt.a)(n,t);var e=Object(ct.a)(n);function n(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Object(lt.a)(this,n),(t=e.call(this)).localeId=r,t._SCRIPT_ID="agmGoogleMapsApiScript",t.callbackName="agmLazyMapsAPILoader",t._config=o||{},t._windowRef=i,t._documentRef=a,t}return Object(st.a)(n,[{key:"load",value:function(){var t=this._windowRef.getNativeWindow();if(t.google&&t.google.maps)return Promise.resolve();if(this._scriptLoadingPromise)return this._scriptLoadingPromise;var e=this._documentRef.getNativeDocument().getElementById(this._SCRIPT_ID);if(e)return this._assignScriptLoadingPromise(e),this._scriptLoadingPromise;var n=this._documentRef.getNativeDocument().createElement("script");return n.type="text/javascript",n.async=!0,n.defer=!0,n.id=this._SCRIPT_ID,n.src=this._getScriptSrc(this.callbackName),this._assignScriptLoadingPromise(n),this._documentRef.getNativeDocument().body.appendChild(n),this._scriptLoadingPromise}},{key:"_assignScriptLoadingPromise",value:function(t){var e=this;this._scriptLoadingPromise=new Promise((function(n,o){e._windowRef.getNativeWindow()[e.callbackName]=function(){n()},t.onerror=function(t){o(t)}}))}},{key:"_getScriptSrc",value:function(t){var e;switch(this._config&&this._config.protocol||ft.HTTPS){case ft.AUTO:e="";break;case ft.HTTP:e="http:";break;case ft.HTTPS:e="https:"}var n=this._config.hostAndPath||"maps.googleapis.com/maps/api/js",o={v:this._config.apiVersion||"quarterly",callback:t,key:this._config.apiKey,client:this._config.clientId,channel:this._config.channel,libraries:this._config.libraries,region:this._config.region,language:this._config.language||"en-US"!==this.localeId?this.localeId:null},i=Object.keys(o).filter((function(t){return null!=o[t]})).filter((function(t){return!Array.isArray(o[t])||Array.isArray(o[t])&&o[t].length>0})).map((function(t){var e=o[t];return Array.isArray(e)?{key:t,value:e.join(",")}:{key:t,value:o[t]}})).map((function(t){return"".concat(t.key,"=").concat(t.value)})).join("&");return"".concat(e,"//").concat(n,"?").concat(i)}}]),n}(dt);return t.\u0275fac=function(e){return new(e||t)(f.dc(mt,8),f.dc(bt),f.dc(ut),f.dc(f.w))},t.\u0275prov=f.Lb({token:t,factory:function(e){return t.\u0275fac(e)}}),t}(),pt=function(){var t=et=function(){function t(){Object(lt.a)(this,t)}return Object(st.a)(t,null,[{key:"forRoot",value:function(t){return{ngModule:et,providers:[].concat(ht,[{provide:dt,useClass:gt},{provide:mt,useValue:t}])}}}]),t}();return t.\u0275mod=f.Nb({type:t}),t.\u0275inj=f.Mb({factory:function(e){return new(e||t)}}),t}(),vt=function(){function t(){}return t.\u0275mod=f.Nb({type:t}),t.\u0275inj=f.Mb({factory:function(e){return new(e||t)},imports:[[i.c,o.g.forChild(at),a.l,a.x,r.a,c.b,_.b,pt.forRoot({apiKey:"YOUR-API-KEY-HERE",libraries:["places"]})]]}),t}()},ls82:function(t,e,n){var o=function(t){"use strict";var e,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(M){s=function(t,e,n){return t[e]=n}}function l(t,e,n,o){var i=Object.create((e&&e.prototype instanceof g?e:g).prototype),a=new T(o||[]);return i._invoke=function(t,e,n){var o=b;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===f){if("throw"===i)throw a;return I()}for(n.method=i,n.arg=a;;){var r=n.delegate;if(r){var c=k(r,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===b)throw o=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=d(t,e,n);if("normal"===s.type){if(o=n.done?f:u,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=f,n.method="throw",n.arg=s.arg)}}}(t,n,a),i}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(M){return{type:"throw",arg:M}}}t.wrap=l;var b="suspendedStart",u="suspendedYield",h="executing",f="completed",m={};function g(){}function p(){}function v(){}var y={};y[a]=function(){return this};var U=Object.getPrototypeOf,C=U&&U(U(L([])));C&&C!==n&&o.call(C,a)&&(y=C);var V=v.prototype=g.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){var n;this._invoke=function(i,a){function r(){return new e((function(n,r){!function n(i,a,r,c){var s=d(t[i],t,a);if("throw"!==s.type){var l=s.arg,b=l.value;return b&&"object"==typeof b&&o.call(b,"__await")?e.resolve(b.__await).then((function(t){n("next",t,r,c)}),(function(t){n("throw",t,r,c)})):e.resolve(b).then((function(t){l.value=t,r(l)}),(function(t){return n("throw",t,r,c)}))}c(s.arg)}(i,a,n,r)}))}return n=n?n.then(r,r):r()}}function k(t,n){var o=t.iterator[n.method];if(o===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=d(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function L(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}return{next:I}}function I(){return{value:e,done:!0}}return p.prototype=V.constructor=v,v.constructor=p,p.displayName=s(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,c,"GeneratorFunction")),t.prototype=Object.create(V),t},t.awrap=function(t){return{__await:t}},w(_.prototype),_.prototype[r]=function(){return this},t.AsyncIterator=_,t.async=function(e,n,o,i,a){void 0===a&&(a=Promise);var r=new _(l(e,n,o,i),a);return t.isGeneratorFunction(n)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},w(V),s(V,c,"Generator"),V[a]=function(){return this},V.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var o=e.pop();if(o in t)return n.value=o,n.done=!1,n}return n.done=!0,n}},t.values=L,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(o,i){return c.type="throw",c.arg=t,n.next=o,i&&(n.method="next",n.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],c=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=o.call(r,"catchLoc"),l=o.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var r=a?a.completion:{};return r.type=t,r.arg=e,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var o=n.completion;if("throw"===o.type){var i=o.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:L(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=o}catch(i){Function("r","regeneratorRuntime = r")(o)}},o0o1:function(t,e,n){t.exports=n("ls82")}}]);